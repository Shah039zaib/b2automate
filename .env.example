# ============================================
# B2Automate - Monorepo Environment Configuration
# ============================================
# This file is for Docker Compose / root-level setup
# For individual service configuration, see below
# ============================================

# ============================================
# ğŸ“ SERVICE-SPECIFIC ENV FILES
# ============================================
# This monorepo has 4 services, each with its own .env file:
#
# 1. apps/api/.env          â†’ Backend API (see apps/api/.env.example)
# 2. apps/web/.env          â†’ Web Frontend (see apps/web/.env.example)
# 3. apps/admin/.env        â†’ Admin Panel (see apps/admin/.env.example)
# 4. apps/whatsapp-worker/.env â†’ WhatsApp Worker (see apps/whatsapp-worker/.env.example)
#
# Quick Setup:
#   cp apps/api/.env.example apps/api/.env
#   cp apps/web/.env.example apps/web/.env
#   cp apps/admin/.env.example apps/admin/.env
#   cp apps/whatsapp-worker/.env.example apps/whatsapp-worker/.env

# ============================================
# SHARED ENVIRONMENT VARIABLES (Docker Compose)
# ============================================
# If using Docker Compose, these variables are shared across services

# ============================================
# DATABASE (Supabase PostgreSQL)
# ============================================
# Get these from: Supabase Dashboard â†’ Settings â†’ Database â†’ Connection Pooling
# IMPORTANT: Use pooler URLs for production (supports IPv4)

# Transaction pooler (port 6543) - for API queries
DATABASE_URL="postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=1"

# Direct connection (port 5432) - for Prisma migrations
DIRECT_URL="postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:5432/postgres"

# ============================================
# REDIS (Session Storage & BullMQ Queues)
# ============================================
# Local development: redis://localhost:6379
# Production: Use Redis Cloud, Upstash, or managed Redis
REDIS_URL="redis://localhost:6379"
REDIS_PASSWORD=""

# For worker-specific Redis config
REDIS_HOST="redis"
REDIS_PORT="6379"

# ============================================
# AUTHENTICATION (JWT)
# ============================================
# CRITICAL: Generate a strong random string (min 32 characters)
# Generate with: openssl rand -base64 64
JWT_SECRET="your-super-secret-jwt-key-change-in-production-min-32-chars"
JWT_ACCESS_EXPIRY="15m"
JWT_REFRESH_EXPIRY="7d"

# ============================================
# AI PROVIDERS
# ============================================
# Provider selection: openai | openrouter
# Recommended: openrouter (cost-effective, 400+ models)
AI_PROVIDER="openrouter"

# --- OpenAI (Premium) ---
# Get from: https://platform.openai.com/api-keys
OPENAI_API_KEY=""

# --- OpenRouter (Recommended) ---
# Get from: https://openrouter.ai/keys
# Free tier: 50 requests/day with free models
OPENROUTER_API_KEY=""

# OpenRouter Model Selection
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ RECOMMENDED MODELS BY TIER                                   â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ FREE ($0):                                                   â”‚
# â”‚   - google/gemini-2.0-flash-exp:free    (default, fast)      â”‚
# â”‚   - meta-llama/llama-3.3-70b-instruct:free  (large, smart)   â”‚
# â”‚   - deepseek/deepseek-chat:free         (good reasoning)     â”‚
# â”‚   - mistralai/mistral-7b-instruct:free  (fast, lightweight)  â”‚
# â”‚   - qwen/qwen-2.5-72b-instruct:free     (multilingual)       â”‚
# â”‚                                                              â”‚
# â”‚ LOW COST (~$0.0001-0.001/1K tokens):                         â”‚
# â”‚   - deepseek/deepseek-chat              (best value)         â”‚
# â”‚   - anthropic/claude-3-haiku            (fast, cheap)        â”‚
# â”‚   - meta-llama/llama-3.1-70b-instruct   (balanced)           â”‚
# â”‚                                                              â”‚
# â”‚ PREMIUM (higher quality/cost):                               â”‚
# â”‚   - anthropic/claude-3.5-sonnet         (best reasoning)     â”‚
# â”‚   - openai/gpt-4o                       (versatile)          â”‚
# â”‚   - google/gemini-1.5-pro               (multimodal)         â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ Full list: https://openrouter.ai/models                      â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
OPENROUTER_MODEL="google/gemini-2.0-flash-exp:free"

# ============================================
# STRIPE BILLING
# ============================================
# Get from: https://dashboard.stripe.com/apikeys
# Test keys start with: sk_test_ and pk_test_
# Live keys start with: sk_live_ and pk_live_
STRIPE_SECRET_KEY=""
STRIPE_PUBLISHABLE_KEY=""

# Webhook signing secret
# Local dev: Use Stripe CLI â†’ stripe listen --forward-to localhost:3000/webhooks/stripe
# Production: Get from Stripe Dashboard â†’ Webhooks â†’ Your endpoint
STRIPE_WEBHOOK_SECRET=""

# ============================================
# FRONTEND URLs
# ============================================
# Main web application
WEB_APP_URL="http://localhost:5173"

# Admin panel
ADMIN_APP_URL="http://localhost:5174"

# Used by API for email templates, redirects, and CORS
FRONTEND_URL="http://localhost:5173"

# ============================================
# WHATSAPP RATE LIMITS
# ============================================
# Global message rate (messages per second per tenant)
WHATSAPP_MESSAGE_RATE_LIMIT="5"

# Per-customer rate limiting (prevents spam to individual customers)
WHATSAPP_CUSTOMER_RATE_LIMIT="10"
WHATSAPP_CUSTOMER_RATE_WINDOW="60"

# ============================================
# VITE (Frontend Build)
# ============================================
# API URL for frontend apps
# Development: http://localhost:3000 or /api (proxied)
# Production: https://yourdomain.com/api
VITE_API_URL="/api"

# ============================================
# SERVER CONFIGURATION
# ============================================
PORT="3000"
NODE_ENV="development"
LOG_LEVEL="info"

# ============================================
# OPTIONAL: EMAIL SERVICE
# ============================================
# Email provider: smtp | sendgrid | ses
EMAIL_PROVIDER="smtp"

# SMTP Configuration (Gmail example)
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_SECURE="false"
SMTP_USER=""
SMTP_PASSWORD=""

# SendGrid
SENDGRID_API_KEY=""

# AWS SES
AWS_SES_REGION="us-east-1"
AWS_SES_ACCESS_KEY_ID=""
AWS_SES_SECRET_ACCESS_KEY=""

# ============================================
# OPTIONAL: MEDIA STORAGE
# ============================================
MEDIA_BUCKET_NAME="whatsapp-media"
MEDIA_STORAGE_PROVIDER="s3"

# AWS S3
AWS_S3_REGION="us-east-1"
AWS_S3_ACCESS_KEY_ID=""
AWS_S3_SECRET_ACCESS_KEY=""

# ============================================
# OPTIONAL: ADVANCED FEATURES
# ============================================
# Audit log retention (days)
AUDIT_LOG_RETENTION_DAYS="90"

# CORS allowed origins (comma-separated)
CORS_ORIGINS="http://localhost:5173,http://localhost:5174"

# Distributed tracing
TRACING_ENABLED="false"
TRACING_PROVIDER="console"

# Secrets management
SECRETS_PROVIDER="env"

# ============================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ============================================
# Before deploying to production, ensure:
# âœ… DATABASE_URL uses Supavisor pooler (not direct connection)
# âœ… JWT_SECRET is a strong random string (min 32 characters)
# âœ… STRIPE keys are live keys (sk_live_), not test
# âœ… WEB_APP_URL, FRONTEND_URL point to your domain
# âœ… Redis has persistence enabled (AOF or RDB)
# âœ… CORS_ORIGINS includes your production domain
# âœ… LOG_LEVEL is set to "info" or "warn" (not "debug")
# âœ… All API keys are rotated from development
# âœ… Stripe webhook endpoint is configured in Stripe Dashboard
# âœ… Email service is configured for password reset
